## –ú–µ—Ç–æ–¥–∏–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω (VM) –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º –∏ —Å–µ—Ç–µ–≤–æ–º iSCSI —Ö—Ä–∞–Ω–∏–ª–∏—â–∞—Ö
## –ö–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π –¥–æ–∫—É–º–µ–Ω—Ç–∞
| –í–µ—Ä—Å–∏—è | –î–∞—Ç–∞ |
|:-------|:-----|
| 1.1 | 22 –æ–∫—Ç—è–±—Ä—è 2025 |
| 1.2 | 23 –æ–∫—Ç—è–±—Ä—è 2025 |
| 1.3 | 06 –Ω–æ—è–±—Ä—è 2025 |
| 1.4 | 13 –Ω–æ—è–±—Ä—è 2025 |

## 	–¶–µ–ª—å: –°—Ä–∞–≤–Ω–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–∏—Å–∫–æ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã –∏ –°–£–ë–î PostgreSQL 17 –ø—Ä–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏–∏ VM –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º RAID10 (Dell R750) —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –Ω–∞ –≤–Ω–µ—à–Ω–µ–º iSCSI —Å–µ—Ç–µ–≤–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –ø–æ–¥–∫–ª—é—á—ë–Ω–Ω–æ–º –ø–æ 25GE/100GE, –≤ —Å—Ä–µ–¥–µ VMware vSphere 8.

## 1. –û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è
–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –æ–¥–Ω–æ–º —Ö–æ—Å—Ç–µ ESXi –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ –¢4 –¥–∞—Ç–∞ —Ü–µ–Ω—Ç—Ä–∞ –í–ö–°.

–°—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–∏—Å–∫–æ–≤—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º VM –¥–ª—è –¥–≤—É—Ö —Ç–∏–ø–æ–≤ —Ö—Ä–∞–Ω–∏–ª–∏—â:
+ –õ–æ–∫–∞–ª—å–Ω—ã–π: VMFS –Ω–∞ RAID10, —Å–æ–±—Ä–∞–Ω–Ω—ã–π –∏–∑ 8 –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∏—Å–∫–æ–≤ –Ω–∞ —Ö–æ—Å—Ç–µ Dell PowerEdge R750.
+ –°–µ—Ç–µ–≤–æ–π: VMFS –Ω–∞ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–º LUN iSCSI-–°–•–î (–±–µ–∑ —Ñ–æ–Ω–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏).

–í—Å–µ VM –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–æ–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –û–° Debian 12.

–¢–µ—Å—Ç—ã –≤–∫–ª—é—á–∞—é—Ç:
+ –ù–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –Ω–∞–≥—Ä—É–∑–∫—É (fio, 60 —Å–µ–∫ –Ω–∞ –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø —Ç–µ—Å—Ç–∞)
+ –ü—Ä–∏–∫–ª–∞–¥–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É PostgreSQL 17 (pgbench)

–ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
+ 1 –í–ú;
+ 4 –í–ú –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –æ–¥–Ω–æ–º —Ö–æ—Å—Ç–µ;
+ –í–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏–∑ –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏;
+ –ö–æ–ª-–≤–æ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—à–∏–Ω –∏ –∏—Ö IP –∞–¥—Ä–µ—Å–∞ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç–∞  `/control/run_tests.sh` –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–º —Ö–æ—Å—Ç–µ.

–°–∫—Ä–∏–ø—Ç `/control/run_tests.sh` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
+ –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ VM –¥–ª—è —Ç–µ—Å—Ç–∞ –∏ –∏—Ö IP-–∞–¥—Ä–µ—Å–∞
  - —Ç–∏–ø —Ç–µ—Å—Ç–∞ (—Ç–æ–ª—å–∫–æ fio, —Ç–æ–ª—å–∫–æ pgbench, –∏–ª–∏ –æ–±–∞)
  - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 3 –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–π –∑–Ω–∞—á–∏–º–æ—Å—Ç–∏)
  - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã fio (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
+ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:
  - –∫–æ–ø–∏—Ä—É–µ—Ç —Å–∫—Ä–∏–ø—Ç `test_fio_7.py` –Ω–∞ –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –í–ú
  - –æ—á–∏—â–∞–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥–æ–π –∏—Ç–µ—Ä–∞—Ü–∏–µ–π
  - –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã —Å –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
  - —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞–ø–∫–∏
+ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

+ –°–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤.

### –¢–µ—Å—Ç fio
–¢–µ—Å—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 5 —ç—Ç–∞–ø–æ–≤:
+ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏ –ø–æ 4–ö (–∏–ª–∏ –∫–∞–∫ –∑–∞–¥–∞–Ω–æ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ);
+ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å –±–ª–æ–∫–∞–º–∏ –ø–æ 4–ö (–∏–ª–∏ –∫–∞–∫ –∑–∞–¥–∞–Ω–æ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ);
+ —Å–ª—É—á–∞–π–Ω–æ–µ —á—Ç–µ–Ω–∏–µ;
+ —Å–ª—É—á–∞–π–Ω–∞—è –∑–∞–ø–∏—Å—å;
+ —Å–º–µ—à–∞–Ω–Ω—ã–π —Ç–µ—Å—Ç –Ω–∞ —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (—Å–º–µ—à–∞–Ω–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ (mixed RW): 60% –∑–∞–ø–∏—Å—å / 40% —á—Ç–µ–Ω–∏–µ).

### –¢–µ—Å—Ç pgbench
–¢–µ—Å—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —ç—Ç–∞–ø–æ–≤:
+ **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è —Å—Ö–µ–º–∞ pgbench —Å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã–º –æ–±—ä—ë–º–æ–º –¥–∞–Ω–Ω—ã—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é scale=100, ~15 –ì–ë), –≤–∫–ª—é—á–∞—é—â–∞—è —Ç–∞–±–ª–∏—Ü—ã —Å—á–µ—Ç–æ–≤, –æ—Ç–¥–µ–ª–µ–Ω–∏–π, –∏—Å—Ç–æ—Ä–∏–∏ –∏ —Ç.–¥.
+ **OLTP-–Ω–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —Ç–µ—Å—Ç** ‚Äî —ç–º—É–ª–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤, –≤—ã–ø–æ–ª–Ω—è—é—â–∏—Ö —Ç–∏–ø–∏—á–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
    + –≤—ã–±–æ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ —Å—á—ë—Ç–∞,
    + –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞,
    + –≤—Å—Ç–∞–≤–∫–∞ –∑–∞–ø–∏—Å–∏ –≤ –∏—Å—Ç–æ—Ä–∏—é.
–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 32 –∫–ª–∏–µ–Ω—Ç–∞, 4 –ø–æ—Ç–æ–∫–∞, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å 600 —Å–µ–∫—É–Ω–¥.

## 2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
<img src="docs/screenshots/DC_test_diagram.png" alt="–°—Ö–µ–º–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è" width="600"/>

### –£—á–∞—Å—Ç–Ω–∏–∫–∏
+ **–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Ö–æ—Å—Ç**: MacBook Pro (–∏–ª–∏ –ª—é–±–æ–π Linux-—Ö–æ—Å—Ç c –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–ø—É—Å–∫–∞ bash –∏ python —Å–∫—Ä–∏–ø—Ç–æ–≤)  
  ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã, —Å–æ–±–∏—Ä–∞–µ—Ç –∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
+ **–¢–µ—Å—Ç–æ–≤—ã–µ –í–ú**: 1‚Äì4 –º–∞—à–∏–Ω—ã —Å Debian 12 –≤ –î–¶ (IP: `10.85.105.181‚Äì184`)  
  ‚Üí –≤—ã–ø–æ–ª–Ω—è—é—Ç `fio` –∏ `pgbench`, –Ω–µ —É—á–∞—Å—Ç–≤—É—é—Ç –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏.

### –°–µ—Ç—å
+ –î–æ—Å—Ç—É–ø –∫ –î–¶ ‚Äî —á–µ—Ä–µ–∑ **VPN-—Ç—É–Ω–Ω–µ–ª—å**
+ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –í–ú ‚Äî –ø–æ **SSH —Å –∫–ª—é—á–∞–º–∏** (–±–µ–∑ –ø–∞—Ä–æ–ª—è)
+ –í—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–∞ **–∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–º —Ö–æ—Å—Ç–µ**


## 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω
| –ü–∞—Ä–∞–º–µ—Ç—Ä  | –ó–Ω–∞—á–µ–Ω–∏–µ |
|:-----------|:--------------|
| –û–°		| Debian 12 (bookworm) |
| vCPU		| 4	—è–¥—Ä–∞		|
| RAM		| 16 –ì–ë		|
| –°–∏—Å—Ç–µ–º–Ω—ã–π –¥–∏—Å–∫ –û–° | 30 –ì–ë, Thick Eager Zeroed |
| –î–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö PostgreSQL | 50 –ì–ë, –æ—Ç–¥–µ–ª—å–Ω—ã–π VMDK, Thick Eager Zeroed, –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä PVSCSI |
| –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –¥–∏—Å–∫–∞ | btrfs |
| –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö | XFS (noatime, logbufs=8, logbsize=256k) |
| Swap | –û—Ç–∫–ª—é—á—ë–Ω |
| –°–µ—Ç–µ–≤–æ–π –∞–¥–∞–ø—Ç–µ—Ä | VMXNET3 |
> –î–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤ /mnt/pgdata –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ PGDATA


## 4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –í–ú
### 4.1 –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –û–°
```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y wget ca-certificates sysstat dstat htop xfsprogs python3 fio

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ swap
sudo swapoff -a
sudo sed -i '/ swap / s/^/#/' /etc/fstab

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —è–¥—Ä–∞
cat <<EOF | sudo tee -a /etc/sysctl.conf
vm.swappiness = 1
vm.overcommit_memory = 2
kernel.shmmax = 4294967296
kernel.shmall = 1048576
EOF
sudo sysctl -p

# –õ–∏–º–∏—Ç—ã
cat <<EOF | sudo tee -a /etc/security/limits.conf
* soft nofile 65536
* hard nofile 65536
postgres soft nofile 65536
postgres hard nofile 65536
EOF

sudo reboot
```

### 4.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏—Å–∫–∞ –ø–æ–¥ PostgreSQL
```bash
sudo mkdir -p /mnt/pgdata
echo '/dev/sdb /mnt/pgdata xfs defaults,noatime,logbufs=8,logbsize=256k 0 0' | sudo tee -a /etc/fstab
sudo mount -a
```

### 4.3 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL 17
```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/postgresql.gpg
echo "deb https://apt.postgresql.org/pub/repos/apt/ bookworm-pgdg main" | sudo tee /etc/apt/sources.list.d/pgdg.list

sudo apt update
sudo apt install -y postgresql-17 postgresql-client-17 postgresql-contrib-17
sudo chown postgres:postgres /mnt/pgdata
```

### 4.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL 17
```bash
sudo systemctl stop postgresql

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –Ω–æ–≤–æ–º —Ç–æ–º–µ
sudo -u postgres initdb -D /mnt/pgdata

# –£–∫–∞–∑–∞—Ç—å PGDATA
sudo sed -i "s|data_directory = '.*'|data_directory = '/mnt/pgdata'|" /etc/postgresql/17/main/postgresql.conf

# –î–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ /mnt/pgdata/postgresql.conf
cat <<EOF | sudo tee -a /mnt/pgdata/postgresql.conf

# === Performance Tuning ===
shared_buffers = 4GB
effective_cache_size = 12GB
work_mem = 64MB
maintenance_work_mem = 1GB

wal_level = replica
max_wal_size = 8GB
min_wal_size = 2GB
checkpoint_timeout = 30min
checkpoint_completion_target = 0.9

max_connections = 200
max_worker_processes = 4
max_parallel_workers_per_gather = 2
max_parallel_workers = 4

log_min_duration_statement = 1000
log_statement = 'none'
EOF


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞—Å—Ç–µ—Ä PostgreSQL
sudo -u postgres /usr/lib/postgresql/17/bin/initdb -D /mnt/pgdata

# –°–æ–∑–¥–∞–µ–º override –¥–ª—è —Å–ª—É–∂–±—ã
sudo mkdir -p /etc/systemd/system/postgresql@17-main.service.d
sudo vim /etc/systemd/system/postgresql@17-main.service.d/override.conf

# –í—Å—Ç–∞–≤–∏—Ç—å –≤ —Ñ–∞–π–ª
[Service]
Environment=PGDATA=/mnt/pgdata

# –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤!)
echo "local all all trust" | sudo tee /mnt/pgdata/pg_hba.conf
echo "host all all 0.0.0.0/0 trust" | sudo tee -a /mnt/pgdata/pg_hba.conf

sudo systemctl start postgresql@17-main
sudo systemctl enable postgresql@17-main

# –ü–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Å–∏—é PostgreSQL
sudo -u postgres psql -c "SELECT version();"
```
–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –¥–µ–ø–ª–æ—è PostgreSQL 17 –∫–ª–∞—Å—Ç–µ—Ä–∞ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç `scripts/setup_postgresql_cluster.sh`

### 4.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ VM
–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤ –Ω–∞ –≤—Å–µ—Ö VM –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ —Ç–µ—Å—Ç–∞–º —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞:
```bash
./scripts/verify_test_env.sh
```
–£–∫–∞–∑–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
+ –í–µ—Ä—Å–∏—é PostgreSQL
+ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
+ –§–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
+ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ ssh –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è (–ø–æ –∫–ª—é—á—É)

## 5. –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
| –≠—Ç–∞–ø | –¢–∏–ø —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ | –ö–æ–ª-–≤–æ –≤ —Ç–µ—Å—Ç–µ | –¢–∏–ø –Ω–∞–≥—Ä—É–∑–∫–∏ | –ö–æ–ª-–≤–æ –ø–æ–≤—Ç–æ—Ä–æ–≤ —Ç–µ—Å—Ç–æ–≤ |
|:-----|:--------------|:---------------|:-------------|:-----------------------|
|1 | –õ–æ–∫–∞–ª—å–Ω–æ–µ | 1 | —Å–∫—Ä–∏–ø—Ç fio (60 —Å–µ–∫) | 	3 |
|2 | –õ–æ–∫–∞–ª—å–Ω–æ–µ | 4 | —Å–∫—Ä–∏–ø—Ç fio (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ 4 VM) | 3|
|3 | –õ–æ–∫–∞–ª—å–Ω–æ–µ | 1 | pgbench | 3 |
|4 | –õ–æ–∫–∞–ª—å–Ω–æ–µ | 4 | pgbench (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ 4 VM) | 3 |
|5 | iSCSI | 1 | —Å–∫—Ä–∏–ø—Ç fio (60 —Å–µ–∫) | 3 |
|6 | iSCSI | 4 | —Å–∫—Ä–∏–ø—Ç fio (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ 4 VM) | 3 |
|7 | iSCSI | 1 | pgbench | 3 |
|8 | iSCSI | 4 | pgbench (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ 4 VM) | 3|

> –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º –≤—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã:
```bash
sudo sh -c "echo 3 > /proc/sys/vm/drop_caches"
sudo systemctl restart postgresql@17-main
```
–ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —ç—Ç–∞–ø—ã 1-4, –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Å–µ—Ç–µ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ iSCSI –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —ç—Ç–∞–ø—ã 5-8 –∏–∑ –ø–ª–∞–Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

## 6. –ù–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Ç–µ—Å—Ç—ã
### 6.1 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç—ã fio –≤ Python —Å–∫—Ä–∏–ø—Ç–µ
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç test_fio_7.py —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

+ --runtime=60 --time_based
+ --rwmixwrite=60 (60% –∑–∞–ø–∏—Å—å)
+ --size=10G, --bs=4k, --iodepth=64, --numjobs=4
+ --direct=1, --ioengine=libaio

–ü—Ä–æ—Ñ–∏–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Ç–∏–ª–∏—Ç–æ–π fio:

+ Sequential Write / Read
+ Random Write / Read
+ Mixed RW (60/40)

### 6.2 –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –±–µ–Ω—á–º–∞—Ä–∫–∞ pgbench
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
```bash
pgbench -i -s 100 postgres
```

OLTP-—Ç–µ—Å—Ç:
```bash
pgbench -c 32 -j 4 -T 600 -P 30 postgres
```

Read-only:
```bash
pgbench -c 32 -j 4 -T 600 -S postgres
```

## 7. –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫
–î–ª—è –∫–∞–∂–¥–æ–π VM:
```bash
dstat -tcmdsn --output /tmp/dstat_$(hostname)_$(date +%s).csv 5 &
iostat -x 5 > /tmp/iostat_$(hostname)_$(date +%s).log &
```

–ù–∞ –≥–∏–ø–µ—Ä–≤–∏–∑–æ—Ä–µ ESXi —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ö–æ—Å—Ç–∞:
+ esxtop ‚Üí %RDY, DAVG/cmd

–ò–∑ PostgreSQL:
```sql
SELECT * FROM pg_stat_wal;
SELECT total_time, calls, mean_time FROM pg_stat_statements ORDER BY mean_time DESC LIMIT 10;
```

## 8. –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ —Å–µ—Ç–µ–≤–æ–µ —Ö—Ä–∞–Ω–∏—â–∏—â–µ iSCSI

### 8.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ iSCSI-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞:

  + –ù–∞—Å—Ç—Ä–æ–π–∫–∞ MTU 9000 –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (ESXi, –°–•–î, –∫–æ–º–º—É—Ç–∞—Ç–æ—Ä—ã)
  + –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ LUN –Ω–∞ –°–•–î –±–µ–∑ —Ñ–æ–Ω–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
  + –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–Ω–æ–≥–æ–∫–∞–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ (multipathing) –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ
  + –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–µ—Ç–∏ —Å –ø–æ–º–æ—â—å—é iperf3

### 8.2. –°–æ–∑–¥–∞–Ω–∏–µ iSCSI datastore –Ω–∞ ESXi —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  + Block size: 1MB (–¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π)
  + Thin provisioning: –æ—Ç–∫–ª—é—á–µ–Ω–æ (–¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏)

### 8.3. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Storage vMotion –≤—Å–µ—Ö –í–ú –Ω–∞ iSCSI datastore
#### 8.3.1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ iSCSI-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏ iSCSI
1. –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–π VLAN –¥–ª—è iSCSI-—Ç—Ä–∞—Ñ–∏–∫–∞:
+ –í vCenter: Networking ‚Üí Distributed Switch ‚Üí Create Distributed Port Group
+ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: "iSCSI-VLAN"
+ VLAN ID: –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π ID –¥–ª—è iSCSI-—Ç—Ä–∞—Ñ–∏–∫–∞
+ Security: Promiscuous mode - Reject, MAC address changes - Accept, Forged transmits - Accept

2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ jumbo frames (MTU 9000):
```bash
# –ù–∞ ESXi —Ö–æ—Å—Ç–µ
esxcli network ip interface set -m 9000 -i vmkX
```

+ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```bash
esxcli network ip interface list | grep -A 5 "vmkX"
```

3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤:

+ –í—ã–¥–µ–ª–µ–Ω–∏–µ –º–∏–Ω–∏–º—É–º 2x10GbE —Å–µ—Ç–µ–≤—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ –Ω–∞ —Ö–æ—Å—Ç –¥–ª—è iSCSI
+ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ –æ—Ç–¥–µ–ª—å–Ω–æ–º—É vSwitch –∏–ª–∏ port group
+ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NIC teaming: Route based on IP hash

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –°–•–î

1. –°–æ–∑–¥–∞–Ω–∏–µ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ LUN:
+ –†–∞–∑–º–µ—Ä: –º–∏–Ω–∏–º—É–º 800 –ì–ë (200 –ì–ë –Ω–∞ –í–ú √ó 4 –í–ú + 20% –∑–∞–ø–∞—Å–∞)
+ –¢–∏–ø —Ç–æ–º–∞: thin/thick provisioning —Å–æ–≥–ª–∞—Å–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è –°–•–î
+ QoS: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –í–ú (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CHAP-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:
+ Mutual CHAP –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
+ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω—ã—Ö –ø–∞—Ä–æ–ª–µ–π (32+ —Å–∏–º–≤–æ–ª–∞)

```bash
# –ü—Ä–∏–º–µ—Ä –¥–ª—è Dell PowerStore
storage config iscsi -enable true -chap true -mutual_chap true
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –°–•–î –ø–µ—Ä–µ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π:
```bash
# –ù–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
iperf3 -c <ip_—Å—Ö–¥> -t 60 -i 5 -P 8 -b 0
fio --name=test --filename=/dev/disk/by-id/<lun_id> \
    --size=100G --rw=randwrite --bs=4k --direct=1 \
    --ioengine=libaio --iodepth=64 --numjobs=8 --runtime=300
```

–î–æ–±–∞–≤–ª–µ–Ω–∏–µ iSCSI-–∞–¥–∞–ø—Ç–µ—Ä–∞ –≤ vSphere

1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ iSCSI-–∞–¥–∞–ø—Ç–µ—Ä–∞:
+ vCenter ‚Üí Host ‚Üí Configure ‚Üí Storage Adapters ‚Üí Add software iSCSI adapter
+ –ò–º—è –∞–¥–∞–ø—Ç–µ—Ä–∞: "iscsi-adapter-storage-test"
+ CHAP Settings: Configure CHAP credentials

2. –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–µ–≤—ã–º vmkernel-–∞–¥–∞–ø—Ç–µ—Ä–∞–º:
+ vCenter ‚Üí Host ‚Üí Configure ‚Üí Networking ‚Üí VMkernel adapters
+ –°–æ–∑–¥–∞–Ω–∏–µ –¥–≤—É—Ö vmk –∞–¥–∞–ø—Ç–µ—Ä–æ–≤ (vmk1, vmk2) –¥–ª—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏
+ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ iSCSI-–∞–¥–∞–ø—Ç–µ—Ä—É: Storage Adapters ‚Üí Select adapter ‚Üí Bind VMkernel adapters

#### 8.3.2. –ü—Ä–æ—Ü–µ–¥—É—Ä–∞ Storage vMotion

1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –í–ú –∫ –º–∏–≥—Ä–∞—Ü–∏–∏:
+ –°–æ–∑–¥–∞–Ω–∏–µ snapshot –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π (–Ω–∞ —Å–ª—É—á–∞–π –æ—Ç–∫–∞—Ç–∞)
```bash
# –ß–µ—Ä–µ–∑ PowerCLI
Get-VM test-vm1 | New-Snapshot -Name "Pre-iSCSI-migration" -Description "Backup before Storage vMotion"
```

+ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–ª—É–∂–± –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏:
```bash
sudo systemctl stop sysstat
sudo systemctl stop rsyslog
```

2. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Storage vMotion:
+ –í vCenter: –ü—Ä–∞–≤–æ–π –∫–Ω–æ–ø–∫–æ–π –Ω–∞ –í–ú ‚Üí Migrate ‚Üí Change storage only
+ Target datastore: –≤—ã–±–∏—Ä–∞–µ–º iSCSI datastore
+ Disk format: Thick Provision Lazy Zeroed
+ Priority: Low priority (—á—Ç–æ–±—ã –Ω–µ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ–Ω–æ—Å–∞)
+ –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –í–ú –ø–æ–æ—á–µ—Ä–µ–¥–Ω–æ (–Ω–µ –±–æ–ª–µ–µ 2 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ)

3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞:
+ –í vCenter: Monitor ‚Üí Tasks & Events
+ –ù–∞ –°–•–î: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–ª–∏ CLI
+ –ù–∞ —Å–µ—Ç–µ–≤–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Ä—Ç–æ–≤ —á–µ—Ä–µ–∑ monitoring —Å–∏—Å—Ç–µ–º—É
+ –†–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏: –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö (4 –í–ú √ó 80 –ì–ë) / –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–µ—Ç–∏

#### 8.3.3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –í–ú:
```bash
# –ù–∞ ESXi —Ö–æ—Å—Ç–µ
vim-cmd vmsvc/getallvms | grep test-vm
vim-cmd vmsvc/get.summary <vmid> | grep powerState
```

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è VMDK-—Ñ–∞–π–ª–æ–≤:
+ –í vCenter: VM ‚Üí Summary ‚Üí Hard disks ‚Äî —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ iSCSI datastore
+ –ù–∞ —Ö–æ—Å—Ç–µ ESXi:
```bash
ls -la /vmfs/volumes/<iscsi_datastore_name>/test-vm1/
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –±–∞–∑–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è:
```bash
# –ù–∞ –í–ú
dd if=/dev/zero of=/tmp/testfile bs=1M count=1024 oflag=direct
sync
rm /tmp/testfile
```


### 8.4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Ç–µ—Å—Ç–æ–≤
#### 8.4.1. –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏:
```bash
# –° –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞
ping -c 4 10.85.105.181
ssh -o ConnectTimeout=5 testuser@10.85.105.181 'echo "SSH connection OK"'
nc -zv 10.85.105.181 5432
```

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ PostgreSQL:
```bash
# –ù–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –í–ú
sudo systemctl status postgresql@17-main --no-pager
sudo -u postgres psql -c "\l"
sudo -u postgres psql -c "SELECT pg_is_in_recovery();"
sudo -u postgres psql -c "SELECT * FROM pg_stat_activity LIMIT 1;"
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Å–∫–æ–≤–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã:
```bash
df -hT /mnt/pgdata
ls -la /mnt/pgdata
xfs_info /mnt/pgdata
mount | grep pgdata
```

#### 8.4.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

1. –¢–µ—Å—Ç–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ PostgreSQL:
```bash
sudo -u postgres psql -c "CREATE DATABASE test_db;"
sudo -u postgres psql -c "CREATE TABLE test_table(id SERIAL PRIMARY KEY, data TEXT);" -d test_db
sudo -u postgres psql -c "INSERT INTO test_table(data) VALUES ('test');" -d test_db
sudo -u postgres psql -c "SELECT COUNT(*) FROM test_table;" -d test_db
sudo -u postgres psql -c "DROP DATABASE test_db;"
```

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è pgbench:
```bash
sudo -u postgres pgbench --version
sudo -u postgres pgbench -i -s1 test_db
sudo -u postgres pgbench -c2 -T10 test_db
sudo -u postgres dropdb test_db
```

#### 8.4.3. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç fio:
```bash
sudo -u postgres fio --name=quick-test --filename=/mnt/pgdata/quicktest \
    --size=1G --rw=randwrite --bs=4k --direct=1 \
    --ioengine=libaio --iodepth=1 --runtime=10 --time_based
```

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏ –¥–æ –°–•–î:
```bash
# –ù–∞ ESXi —Ö–æ—Å—Ç–µ
vmkping -I vmk1 <ip_—Å—Ö–¥> -c 100 -s 8972 -d
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:
```bash
sudo apt install mtr -y
mtr -c 100 <ip_—Å—Ö–¥> --report
```

#### 8.4.4. –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

1. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏:
```bash
./scripts/verify_test_env.sh
```

+ –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
```bash
‚úÖ –°–ª—É–∂–±–∞ –∞–∫—Ç–∏–≤–Ω–∞
‚úÖ data_directory = /mnt/pgdata
‚úÖ –í–µ—Ä—Å–∏—è 17.x
‚úÖ shared_buffers = 4GB
‚úÖ effective_cache_size = 12GB
‚úÖ max_connections = 200
‚úÖ listen_addresses = '*'
‚úÖ –í–ª–∞–¥–µ–ª–µ—Ü /mnt/pg postgres:postgres
‚úÖ –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞: XFS
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–µ–∑ –ø–∞—Ä–æ–ª—è
‚úÖ –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏ —É—Å–ø–µ—à–µ–Ω

üéâ –í–°–Å –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ!
```

2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —è–¥—Ä–∞:
```bash
sysctl vm.swappiness vm.overcommit_memory vm.dirty_ratio
```

+ –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
```bash
vm.swappiness = 1
vm.overcommit_memory = 2
vm.dirty_ratio = 15
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–µ–π –∏ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã:
```bash
free -h
uptime
sudo iostat -x 1 3
```

4. –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º:
```bash
sudo sync
sudo sh -c "echo 3 > /proc/sys/vm/drop_caches"
sudo systemctl restart postgresql@17-main
sudo rm -f /mnt/pgdata/quicktest*
```
–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ—Ö —ç—Ç–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∞—Ç—å –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ (—ç—Ç–∞–ø—ã 5-8 –ø–ª–∞–Ω–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è). –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±—É–¥—É—Ç –æ–±—ä–µ–∫—Ç–∏–≤–Ω—ã–º–∏ –∏ –Ω–µ –±—É–¥—É—Ç –∏—Å–∫–∞–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –∏–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é —Ä–µ—Å—É—Ä—Å–æ–≤.

## 9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤—ã—Ö —ç—Ç–∞–ø–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Ç—Ä–∏ —ç—Ç–∞–ø–∞:

### 9.1 –ê–≥—Ä–µ–≥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
```bash
python3 aggregate_results.py results/20251113_1430_storage1_1VM_3iter/
python3 aggregate_results.py results/20251113_1500_storage1_2VMs_3iter/
# ... –¥–ª—è –≤—Å–µ—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
```
–°–∫—Ä–∏–ø—Ç `aggregate_results.py`:
+ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–æ–¥–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
+ –í—ã—á–∏—Å–ª—è–µ—Ç —Å—Ä–µ–¥–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –º–µ—Ç—Ä–∏–∫–∏
+ –§–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç—á—ë—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö JSON –∏ TXT

### 9.2 –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```bash
python3 visualize_results.py results/*/aggregated_report.json
```

–°–∫—Ä–∏–ø—Ç `visualize_results.py` —Å–æ–∑–¥–∞—ë—Ç –≤ –ø–∞–ø–∫–µ `visualization_output/`:
+ –ì—Ä–∞—Ñ–∏–∫–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è IOPS, Bandwidth –∏ Latency –º–µ–∂–¥—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏
+ –ì—Ä–∞—Ñ–∏–∫–∏ TPS –∏ –∑–∞–¥–µ—Ä–∂–µ–∫ pgbench
+ –ì—Ä–∞—Ñ–∏–∫ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –í–ú

### 9.3 –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—Ä–∞—â–∞–µ–º –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞:

+ –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫—É—é –∑–Ω–∞—á–∏–º–æ—Å—Ç—å (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–≤—ã—à–∞—Ç—å 5-10%)
+ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (–ª–∏–Ω–µ–π–Ω—ã–π —Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –í–ú)
+ –û—Ç–Ω–æ—à–µ–Ω–∏–µ —Ü–µ–Ω—ã –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞


## 10. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–ú–µ—Ç–æ–¥–∏–∫–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ –æ—Ü–µ–Ω–∏—Ç—å –≤–ª–∏—è–Ω–∏–µ —Ç–∏–ø–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å PostgreSQL 17 –≤ —É—Å–ª–æ–≤–∏—è—Ö —Ä–µ–∞–ª—å–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.
